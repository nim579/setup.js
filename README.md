# Setup.js

## Установка

Устанавливаем как обычный npm модуль.

Далее выполняем `$(npm bin)/setup init`, если нужно выставляем параметры описаные ниже. Инициализатор пропишет скрипт выполнения и настройки в *package.json* проекта использующего модуль.

## Принцип работы

**Setup.js** пользуется тремя файлами, пути к которым берет в *package.json* — *config*, *settings* и *presets*.

*Config* соответственно главный файл конфигурации проекта (по умолчанию `./config.json`). *Settings* — файл с дефолтными настройками (по умолчанию `./settings.json`). *Presets* — файл с пресетами, удобно использовать например для переключения между стендами (по умолчанию `./environments.json`).

У **Setup.js** есть команты и параметры, о них подробнее ниже. Если выполнять скрипт без команд, а просто с параметрами, то параметры будут сохранены в *package.json*. Если скрипт выполнить с командой и параметрами, то параметры будут применены к команде и сохранены не будут.

## Вызов

После установки **Setup.js**, его удобно можно вызывать командой `npm run setup` передавая все необходимые параметры и команды как обычно.

## Параметры
* **-h, --help** — показывает хэлп
* **-V, --version** — показывает текущую версию **Setup.js**;
* **-v, --verbose** — показывает, что сохраняет (это может быть конфиг и *package.json* с параметрами);
* **-c, --config [file]** — устанавливает путь до *config*-файла. Будет использован для команды, **или** сохранен в настройках;
* **-p, --presets [file]** — устанавливает путь до *presets*-файла. Будет использован для команды, **или** сохранен в настройках;
* **-s, --settings [file]** — устанавливает путь до *settings*-файла. Будет использован для команды, **или** сохранен в настройках.

## Команды
* **init** — инициализирует **Setup.js** в проекте;
* **preset [name]** — настраивает конфиг из пресетов проводя deep object extend;
* **set [varValuePairs...]** — устанавливает параметры парами;
* **unset [vars...]** — удаляет параметры;
* **reset** — сбрасывает конфиг до дефолтных значений.

### preset
Настраивает конфиг на основе пресета. Файл с пресетом должен содержать в себе объект с ключами на первом уровне соответствующими названиями (см. `./examples/environments.json`). Для конфига на основе пресета проводится deep object extend, что позволяет делать пресет для любого уровня вложенности.

### set
Принимает любое количество пар настроек (ключ/значение). Например:
```
setup set build.transport.api.url 'ws://ayyo.ru' build.Samsung.resolutionHeight 1280 build.array '[1,2,3]'
```

установит объект
``` js
{
    "build": {
        "transport": {
            "api": "ws://ayyo.ru"
        },
        "Samsung": {
            "resolutionHeight": 1280,
            "resolutionWidth": 720 // этот параметр, например уже был
        },
        "array": [1, 2, 3]
    }
}
```

Обратите внимание, что команда автоматически пытается найти тип переданного значения. Команда создает объекты с большим уровнем вложенности, а при их существовании не испортит их, заменив только переданное значение.

### unset
Удаляет параметры на любом уровне вложенности. Работает как set но только удаляет значения. Принимает любое количество ключей для удаления. Команда не испотрит глубокие объекты удалив только переданный ключ.

```
setup unset build.Samsung.resolutionHeight build.transport
```

В итоге получится вот такой объект (исходный из примера выше):
``` js
{
    "build": {
        "Samsung": {
            "resolutionWidth": 720
        },
        "array": [1, 2, 3]
    }
}
```
